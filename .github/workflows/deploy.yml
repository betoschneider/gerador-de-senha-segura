name: ğŸš€ Deploy automÃ¡tico no servidor

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: ğŸš€ Deploy na pasta local existente
        run: |
          echo "ğŸ“‚ Acessando pasta do projeto..."
          cd /home/beto/projetos/gerador-de-senha-segura
          
          echo "â¬‡ï¸ Atualizando cÃ³digo via Git..."
          # Garante que o git confie na pasta (seguranÃ§a do git moderno)
          git config --global --add safe.directory /home/beto/projetos/gerador-de-senha-segura
          
          git fetch origin main
          git reset --hard origin/main
          
          echo "ğŸ³ Recriando containers..."
          docker compose down --rmi local
          docker compose up -d --build
          docker image prune -f  
      
      - name: ğŸ¥ Check Health
        run: docker ps | grep api-container